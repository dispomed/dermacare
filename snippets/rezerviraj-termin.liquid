{% doc %}
Product card snippet

@param {string} CTA - Button label
@param {object} detalji_tretmana - Centers where the treatment is available

@example
{% render 'rezerviraj-termin', CTA: 'Rezerviraj sad', product: product %}

{% enddoc %}

{% assign centri = product.metafields.custom.tretmani_dostupni_centri.value %}

{%- comment -%}
  First, check if any center has dxc_filter = true.
  If so, set a flag to disable the button.
{%- endcomment -%}
{% assign disable_button = false %}
{% for centar in centri %}
  {% if centar.dxc_filter == true %}
    {% assign disable_button = true %}
  {% endif %}
{% endfor %}

<button {% if disable_button %}disabled{% endif %} type="button" id="tretman-popis-centra" class="reveal-app-block-btn button button--full-width product-form__submit button--primary" aria-expanded="false">
  {{ CTA }}
  <svg class="caret" width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M16.5303 8.96967C16.8232 9.26256 16.8232 9.73744 16.5303 10.0303L12.5303 14.0303C12.2374 14.3232 11.7626 14.3232 11.4697 14.0303L7.46967 10.0303C7.17678 9.73744 7.17678 9.26256 7.46967 8.96967C7.76256 8.67678 8.23744 8.67678 8.53033 8.96967L12 12.4393L15.4697 8.96967C15.7626 8.67678 16.2374 8.67678 16.5303 8.96967Z" fill="currentColor"/>
  </svg>
</button>
<ul id="popis-centra-dropdown" class="dropdown collapsed">
  {% for centar in centri %}
    {% if centar.dxc_filter == false %}
      <li class="flex gap-6 items-center p-2 hover:bg-gray-100 cursor-pointer">
        <div>
          <a href="{{ centar.url | default: '#' }}">{{ centar.ime }} {{ centar.handle }}</a>
        </div>
      </li>
    {% endif %}
  {% endfor %}
</ul>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const button = document.querySelector("#tretman-popis-centra")
          button.addEventListener("click", () => {           
                const target = document.querySelector("#popis-centra-dropdown");
                if (!target) return;

                const expanded = target.classList.toggle("expanded");
                target.classList.toggle("collapsed", !expanded);

                button.setAttribute("aria-expanded", expanded);

            });
        });
</script>

